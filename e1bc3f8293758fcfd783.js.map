{"version":3,"sources":["webpack:///./node_modules/@ecomplus/widget-search-engine/src/index.js"],"names":["options","elId","$searchEngine","document","getElementById","$dock","$productItems","getScopedSlots","window","storefront","urlParams","URLSearchParams","location","search","props","term","get","page","parseInt","brands","getAll","categories","forEach","resource","dataset","JSON","parse","err","console","error","length","charAt","toUpperCase","slice","defaultSort","hasPopularItems","body","Error","vueApp","Vue","data","countRequests","canShowItems","render","createElement","vm","this","on","fetch","fetching","then","result","renderNewItems","$","remove","hits","isSameItems","i","find","_id","SearchEngine","attrs","id","loadMoreSelector","scopedSlots","undefined","append","mount","$mount","observer","MutationObserver","clearTimeout","fallbackTimer","disconnect","setTimeout","observe","childList"],"mappings":";mJAUe,WAACA,EAAU,GAAIC,EAAO,mBACnC,MAAMC,EAAgBC,SAASC,eAAeH,GAC9C,GAAIC,EAAe,CACjB,MAAMG,EAAQF,SAASC,eAAT,UAA2BH,EAA3B,UACd,IAAIK,EACJ,MAAMC,EAAiBC,OAAOC,YAAcD,OAAOC,WAAWF,eAExDG,EAAY,IAAIC,gBAAgBH,OAAOI,SAASC,QAChDC,EAAQ,IACTd,EAAQc,MACXC,KAAML,EAAUM,IAAI,QACpBC,KAAMC,SAASR,EAAUM,IAAI,QAAS,KAAO,EAC7CG,OAAQT,EAAUU,OAAO,YACzBC,WAAYX,EAAUU,OAAO,iBAG9B,CAAC,SAAU,cAAcE,SAAQC,IAChC,GAAIrB,EAAcsB,QAAQD,GAAW,CACnC,IACET,EAAMS,GAAYE,KAAKC,MAAMxB,EAAcsB,QAAQD,IACnD,MAAOI,GAEP,YADAC,QAAQC,MAAMF,GAGZb,EAAMS,IAAaT,EAAMS,GAAUO,OAAS,IAC9ChB,EAAM,UAAD,OAAWS,EAASQ,OAAO,GAAGC,eAA9B,OAA8CT,EAASU,MAAM,MAAQ,GAE5EnB,EAAMoB,YAAc,QACpBpB,EAAMqB,iBAAkB,MAI5B,MAAM,SAAEZ,GAAaf,OAAOL,SAASiC,KAAKZ,QAC1C,OAAQD,GACN,IAAK,SACL,IAAK,aACH,IAAKT,EAAMS,KAAcT,EAAMS,GAAUO,OAEvC,YADAF,QAAQC,MAAM,IAAIQ,MAAJ,4CAA+Cd,EAA/C,cAKpB,MAAMe,EAAS,IAAIC,IAAI,CACrBC,KAAM,CACJC,cAAe,EACfC,cAAerC,EACfU,KAAMD,EAAMC,MAGd4B,OAAQC,GACN,MAAMC,EAAKC,KACLC,EAAK,CACT,cAAehC,GACb8B,EAAG9B,KAAOA,IAqCd,OAjCIV,IACF0C,EAAGC,MAAQ,UAAU,SAAEC,IACrBA,EAASC,MAAKC,IACZN,EAAGJ,gBACH,MAAMW,EAAiB,KACrBP,EAAGH,cAAe,EAClBW,YAAE,uBAAuBC,UAE3B,IAAKT,EAAGH,aACN,GAAIG,EAAGJ,cAAgB,EACrBW,SACK,GAAID,GAAUA,EAAOI,KAC1B,GAAKjD,GAAiBA,EAAcwB,SAAWqB,EAAOI,KAAKA,KAAKzB,OAEzD,CACL,IAAI0B,GAAc,EAClB,MAAM,KAAED,GAASJ,EAAOI,KACxB,IAAK,IAAIE,EAAI,EAAGA,EAAIF,EAAKzB,OAAQ2B,IAC/B,IAAKnD,EAAcoD,KAAd,4BAAwCH,EAAKE,GAAGE,IAAhD,OAAyD7B,OAAQ,CACpE0B,GAAc,EACd,MAGCA,GACHJ,SAXFA,SAoBLR,EAAcgB,IAAc,CACjCC,MAAO,CACLC,GAAIzD,EAAQ,KAAOJ,GAErBa,MAAO,IACFA,EACHC,KAAM8B,EAAG9B,KACT2B,aAAcG,EAAGH,aACjBqB,iBAAkB1D,EAAQ,sBAAwB,MAEpD0C,KACAiB,YAAuC,mBAAnBzD,EAChBA,EAAeL,EAAe0C,GAAgBvC,QAC9C4D,OAKV,GAAI5D,EAAO,CACTgD,YAAEnD,GAAegE,OAAOb,YAAE,QAAS,CACjCS,GAAI,wBAGN,MAAMK,EAAQ,IAAM7B,EAAO8B,OAAO/D,GAElC,GADAC,EAAgB+C,YAAE,qCACd/C,EAAcwB,OAAQ,CACxB,MAAMuC,EAAW,IAAI7D,OAAO8D,kBAAiB,KAC3CC,aAAaC,GACbH,EAASI,aACTC,WAAWP,EAAO,QAEpBE,EAASM,QAAQrE,EAAc,GAAI,CACjCsE,WAAW,IAEb,MAAMJ,EAAgBE,YAAW,KAC/BL,EAASI,aACTN,MACC,UAEHA,SAGF7B,EAAO8B,OAAOlE","file":"e1bc3f8293758fcfd783.js","sourcesContent":["/*!\n * @ecomplus/widget-search-engine\n * (c) E-Com Club <ti@e-com.club>\n * Released under the MIT License.\n */\n\nimport { $ } from '@ecomplus/storefront-twbs'\nimport Vue from 'vue'\nimport SearchEngine from '#components/SearchEngine.vue'\n\nexport default (options = {}, elId = 'search-engine') => {\n  const $searchEngine = document.getElementById(elId)\n  if ($searchEngine) {\n    const $dock = document.getElementById(`${elId}-dock`)\n    let $productItems\n    const getScopedSlots = window.storefront && window.storefront.getScopedSlots\n\n    const urlParams = new URLSearchParams(window.location.search)\n    const props = {\n      ...options.props,\n      term: urlParams.get('term'),\n      page: parseInt(urlParams.get('page'), 10) || 1,\n      brands: urlParams.getAll('brands[]'),\n      categories: urlParams.getAll('categories[]')\n    }\n\n    ;['brands', 'categories'].forEach(resource => {\n      if ($searchEngine.dataset[resource]) {\n        try {\n          props[resource] = JSON.parse($searchEngine.dataset[resource])\n        } catch (err) {\n          console.error(err)\n          return\n        }\n        if (props[resource] && props[resource].length < 2) {\n          props[`isFixed${resource.charAt(0).toUpperCase()}${resource.slice(1)}`] = true\n        }\n        props.defaultSort = 'sales'\n        props.hasPopularItems = false\n      }\n    })\n\n    const { resource } = window.document.body.dataset\n    switch (resource) {\n      case 'brands':\n      case 'categories':\n        if (!props[resource] || !props[resource].length) {\n          console.error(new Error(`Skipping SearchEngine with empty '${resource}' filter`))\n          return\n        }\n    }\n\n    const vueApp = new Vue({\n      data: {\n        countRequests: 0,\n        canShowItems: !$dock,\n        term: props.term\n      },\n\n      render (createElement) {\n        const vm = this\n        const on = {\n          'update:term' (term) {\n            vm.term = term\n          }\n        }\n\n        if ($dock) {\n          on.fetch = function ({ fetching }) {\n            fetching.then(result => {\n              vm.countRequests++\n              const renderNewItems = () => {\n                vm.canShowItems = true\n                $('#search-engine-snap').remove()\n              }\n              if (!vm.canShowItems) {\n                if (vm.countRequests > 1) {\n                  renderNewItems()\n                } else if (result && result.hits) {\n                  if (!$productItems || $productItems.length !== result.hits.hits.length) {\n                    renderNewItems()\n                  } else {\n                    let isSameItems = true\n                    const { hits } = result.hits\n                    for (let i = 0; i < hits.length; i++) {\n                      if (!$productItems.find(`[data-product-id=\"${hits[i]._id}\"]`).length) {\n                        isSameItems = false\n                        break\n                      }\n                    }\n                    if (!isSameItems) {\n                      renderNewItems()\n                    }\n                  }\n                }\n              }\n            })\n          }\n        }\n\n        return createElement(SearchEngine, {\n          attrs: {\n            id: $dock ? null : elId\n          },\n          props: {\n            ...props,\n            term: vm.term,\n            canShowItems: vm.canShowItems,\n            loadMoreSelector: $dock ? '#search-engine-load' : null\n          },\n          on,\n          scopedSlots: typeof getScopedSlots === 'function'\n            ? getScopedSlots($searchEngine, createElement, !$dock)\n            : undefined\n        })\n      }\n    })\n\n    if ($dock) {\n      $($searchEngine).append($('<div>', {\n        id: 'search-engine-load'\n      }))\n\n      const mount = () => vueApp.$mount($dock)\n      $productItems = $('#search-engine-snap .product-item')\n      if ($productItems.length) {\n        const observer = new window.MutationObserver(() => {\n          clearTimeout(fallbackTimer)\n          observer.disconnect()\n          setTimeout(mount, 150)\n        })\n        observer.observe($productItems[0], {\n          childList: true\n        })\n        const fallbackTimer = setTimeout(() => {\n          observer.disconnect()\n          mount()\n        }, 3000)\n      } else {\n        mount()\n      }\n    } else {\n      vueApp.$mount($searchEngine)\n    }\n  }\n}\n"],"sourceRoot":""}